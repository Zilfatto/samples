{% extends "layout.html" %}


{% block title %}
    Register
{% endblock %}

{% block style %}
        <style>
            #head_img, footer {
                display: none;
            }
            input[type=text], input[type=password], input[type=email] {
                width: 100%;
                font-weight: 500;
                padding: 12px 20px;
                border: 3px solid #ccc;
                transition: 0.7s;
                outline: none;
                display: block;
                margin: 8px 0;
                box-sizing: border-box;
            }
            #form1 button {
                width: 100%;
                font-family: "Railway", Arial, Helvetica, sans-serif;
                font-size: 18px;
                letter-spacing: 2px;
                background-image: linear-gradient(to right top, #4dffb8, #4dff4d);
                color: black;
                padding: 14px 20px;
                margin: 8px 0;
                border: 2px outset #ccc;
                cursor: pointer;
            }
            .form {
                max-width: 700px;
                border-radius: 5px;
                background-color: white;
                padding: 20px 30px !important;
                margin-bottom: 70px;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }
            .form-control {
                margin-bottom: 10px;
            	padding-bottom: 20px;
            	position: relative;
            }
            .custom-select.form-control, .autocomplete.form-control {
                padding-bottom: 0;
                margin-bottom: 30px;
            }
            .form-control.success input, .form-control.success .radio {border: 3px solid #1aff1a;}
            .form-control.error input, .form-control.error .radio {border: 3px solid #ff2e10;}
            .form-control i {
            	position: absolute;
            	top: 50px;
            	right: 13px;
            	font-size: 25px;
            	visibility: hidden;
            }
            .custom-select.form-control i {top:41px;}
            .form-control.success i.fa-check-circle {
            	color: #00b300;
            	visibility: visible;
            }
            .form-control.error i.fa-exclamation-circle {
            	color: #e62e00;
            	visibility: visible;
            }
            .custom-select.form-control.error i.fa-exclamation-circle {color: #cc0000;}
            .custom-select.form-control.success i.fa-check-circle {color: #006000;}
            .form-control small {
            	color: #e74c3c;
            	position: absolute;
            	visibility: hidden;
            	bottom: 5px;
            	left: 3px;
            }
            .pd-for-text .hint {
                visibility: visible;
                color: #2a2a2a;
                opacity: 0.8;
                bottom:-17px;
            }
            .custom-select.form-control small, .autocomplete.form-control small {bottom: -23px;}
            .radio small {bottom: -3px;}
            .form-control.error small {visibility: visible;}
            .pd-for-text.error .hint, .pd-for-text.success .hint {visibility: hidden;}
            .extra-margin {
                display: inline-block;
                margin-bottom: 5px;
            }
            .form-control > label {
                background-color: #111;
                color: #ffffff;
                padding: 0 8px;
                border-radius: 40px 20px 40px 20px;
            }
            input[type=text]:focus, input[type=password]:focus, input[type=email]:focus {
                border: 3px solid #555;
                background-color: #d9d9d9;
                color: black;
            }
            #form1 button:hover {
                background-image: linear-gradient(to right top, #00664d, #009900);
                color: white;
            }
            input[type=text]::placeholder, input[type=password]::placeholder, input[type=email]::placeholder {
                font-weight: 400;
                opacity: 0.7;
            }
            input[type=text]:focus::placeholder, input[type=password]:focus::placeholder, input[type=email]:focus::placeholder {
                color: #666;
                font-weight: 400;
                opacity: 1;  /* Firefox */
            }
            .form-head {
                max-width:700px;
                border-radius:60px 60px 0 0;
                text-shadow: -1px 2px 6px black, 0 0 9px blue, 0 0 7px darkblue;
            }
            .pd-for-text {margin-bottom:28px;}
            .pd-for-text.error,.pd-for-text.success{padding-bottom:2px;}
            .pd-for-text.error small{bottom:-13px;}
            .age {
                max-width: 260px;
                padding: 4px 10px;
                border: 1px ridge black;
                border-radius: 4px;
                outline:0;
            }
            .age:hover, .custom-select select:hover {
                border: 1px solid blue;
                box-shadow: 0 0 0 3px rgba(51, 204, 255, 0.5);
                border-radius: 5px;
            }
            .radio {
                width: 50%;
                display: block;
                border-radius: 5px;
                padding: 6px 12px;
                /*background-color: rgba(179, 179, 0, 0.4);*/
            }
            .radio div:not(:last-of-type) {border-bottom: 1px groove black;}
            .radio label:hover {
                color: white;
                text-shadow: 1px 1px 2px black, 0 0 25px blue, 0 0 5px darkblue;
            }
            /* Customize the label (the container) */
            .container {
                display: inline-block;
                position: relative;
                padding-left: 35px;
                margin: 8px 0;
                font-size: 18px;
                cursor: pointer;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            /* Hide the browser's default radio button */
            .container input {
                position: absolute;
                opacity: 0;
                height: 0;
                width: 0;
            }
            /* Create a custom radio button */
            .checkmark {
                position: absolute;
                top: 0;
                left: 0;
                height: 25px;
                width: 25px;
                background-color: #e0e0e0;
                border-radius: 50%;
            }
            /* On mouse-over, add a grey background color */
            .container:hover input ~ .checkmark {background-color: #bbb;}
            /* When the radio button is checked, add a blue background */
            .container input:checked ~ .checkmark {background-color: #00cccc;}
            /* Create the indicator (the dot/circle - hidden when not checked) */
            .checkmark:after {
                content: "";
                position: absolute;
                display: none;
            }
            /* Show the indicator (dot/circle) when checked */
            .container input:checked ~ .checkmark:after {display: block;}
            /* Style the indicator (dot/circle) */
            .container .checkmark:after {
                top: 9px;
                left: 9px;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: white;
            }
            .field-icon {
                color: #000;
                font-size: 23px;
                float: right;
                margin-right: 35px;
                margin-top: -48px;
                position: relative;
                z-index: 2;
            }
            /* autocomplete for countries*/
            .autocomplete {display:block;}
            .autocomplete-items {
                position: absolute;
                border: 2px solid #d4d4d4;
                border-bottom: none;
                border-top: none;
                z-index: 9;
                /*position the autocomplete items to be the same width as the container*/
                top: 100%;
                left: 0;
                right: 0;
                max-height:555%;
                overflow-y:auto;
            }
            .autocomplete-items div {
                padding: 10px;
                cursor: pointer;
                background-color: #fff;
                border-bottom: 1px solid black;
            }
            /*when navigating through the items using the arrow keys*/
            /* or hovering over items*/
            .autocomplete-active, .autocomplete-items div:hover {
                background-color: black !important;
                color: #ffffff;
            }
            /* Custom scroll bar */
            .autocomplete-items{-webkit-overflow-scrolling:touch;overflow:auto;}
            .autocomplete-items::-webkit-scrollbar{width:8px;}
            .autocomplete-items::-webkit-scrollbar-track{background:#393939;}
            .autocomplete-items::-webkit-scrollbar-thumb{background:#00a3cc;}
            /*Custom select for transport*/
            .custom-select {position:relative;}
            .select-selected {background-color:#7a7a7a;}
            .custom-select.error .select-selected {border: 2px solid red;}
            .custom-select.success .select-selected {
                box-shadow: 0 0 0 3px #1aff1a;
                border-radius: 5px;
            }
            /*Style the arrow inside the select element*/
            .select-selected:after {
                position: absolute;
                content: "";
                top: 50px;
                right: 12px;
                width: 0;
                height: 0;
                border: 6px solid transparent;
                border-color: #fff transparent transparent transparent;
            }
            /*Point the arrow upwards when the select box is open (active)*/
            .select-selected.select-arrow-active:after {
                border-color: transparent transparent #fff transparent;
                top: 43px;
            }
            /*Style the items (options), including the selected item*/
            .select-items div,.select-selected {
                color: #ffffff;
                padding: 8px 16px;
                border: 1px solid transparent;
                border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
                cursor: pointer;
                user-select: none;
            }
            /*Style items (options)*/
            .select-items {
                position: absolute;
                background-color: #898989;
                top: 100%;
                left: 0;
                right: 0;
                max-height: 300%;
                overflow-y:auto;
                z-index: 9;
            }
            /*Hide the items when the select box is closed*/
            .select-hide {display:none;}
            .select-items div:hover, .same-as-selected {background-color:rgba(0, 0, 0, 0.2);}
            #notification {
                max-width: 700px;
                margin: 0 auto;
                padding: 16px;
                background-color: #e6e600;
                font-weight: 500;
                color: black;
            }
            #notification p:last-of-type {
                border:0px solid #0099cc;
                border-bottom-width:3px;
                border-top-width:3px;
            }
            @media screen and (max-width:600px){.form{padding:15px 20px!important;}.form-control{margin-bottom:0;}.pd-for-text{margin-bottom:20px;}.pd-for-text.error,.pd-for-text.success{padding-bottom:2px;}.pd-for-text.error small{bottom:-12px;}.radio{width:75%;}.header-text{padding:16px 8px!important;border-radius:30px 30px 0 0;}.field-icon{font-size:19px;margin-top:-45px;}}
            @media screen and (max-width:530px){.pd-for-text{padding-bottom:40px;}}
            @media screen and (max-width:400px){.pd-for-text{padding-bottom:34px;}.pd-for-text .hint{font-size:13px;}}
            @media screen and (max-width:380px){.form{padding:10px 15px!important;}.header-text{font-size:30px!important;}}
            @media screen and (max-width:350px){.form{padding:8px 9px!important;}input, label, #form1 .select-selected, #form1 .autocomplete-items, #notification{font-size:15px;}.form-control small{font-size:12px;}.pd-for-text{padding-bottom:32px;}#form1 button{margin-top:20px;font-size:15px;}}
        </style>
{% endblock %}

{% block main %}
            <div class="w3-margin">
                <h2 class="w3-padding-32 w3-content w3-center blue-black-grad header-text form-head">Form</h2>
                <div id="notification" class="w3-panel w3-topbar w3-bottombar w3-border-black">
                    <a href="javascript:void(0)" onclick="this.parentNode.style.display='none'" class="w3-button w3-xlarge w3-right">&times;</a>
                    <p>My project uses cookies for performance and analytics. By using this website, you accept this use.</p>
                    <p class="w3-center">Do not type your real data. This is about fun, so provide fake, but valid data.</p>
                </div>
                <div class="w3-content form w3-padding w3-round-large my-xxcard w3-white">
                    <form id="form1" name="form1" action="/register" method="post" novalidate="novalidate">
                        <div class="form-control">
                            <label>Username</label>
                            <input type="text" name="username" placeholder="Your username" autofocus="autofocus" maxlength="127" />
                            <i class="fa fa-check-circle"></i>
                			<i class="fa fa-exclamation-circle"></i>
                			<small>Error message</small>
                        </div>
                        <div class="form-control">
                            <label>Email</label>
                            <input type="email" name="email" placeholder="Your email" maxlength="255" />
                            <i class="fa fa-check-circle"></i>
                			<i class="fa fa-exclamation-circle"></i>
                			<small>Error message</small>
                        </div>
                        <div class="pd-for-text form-control">
                            <label>Password</label>
                            <input type="password" autocomplete="off" name="password" placeholder="Enter a password" maxlength="64" />
                            <span class="fa fa-fw fa-eye field-icon toggle-password"></span>
                            <i class="fa fa-check-circle"></i>
                			<i class="fa fa-exclamation-circle"></i>
                			<small>Error message</small>
                			<small class="hint">Your password must be 6-40 characters long, contain uppercase and lowercase letters and numbers, and must not contain spaces or emoji</small>
                        </div>
                        <div class="form-control">
                            <label>Confirmation</label>
                            <input type="password" autocomplete="off" name="confirm" placeholder="Enter your password again" maxlength="64" />
                            <span class="fa fa-fw fa-eye field-icon toggle-password"></span>
                            <i class="fa fa-check-circle"></i>
                			<i class="fa fa-exclamation-circle"></i>
                			<small>Error message</small>
                        </div>
                        <div class="autocomplete form-control">
                            <label>Country</label>
                            <input id="country" type="text" autocomplete="off" name="country" placeholder="Your country" />
                            <i class="fa fa-check-circle"></i>
                			<i class="fa fa-exclamation-circle"></i>
                            <small>Error message</small>
                        </div>
                        <div class="form-control">
                            <label for="age">Your age:</label>
                            <input id="age" class="age" type="number" name="age" min="1" max="150" step="1" />
                			<small style="bottom:-5px;">Error message</small>
            	        </div>
            	        <div class="custom-select w3-margin-top form-control">
            	            <label class="extra-margin">Transport</label>
                	        <select name="transport">
                		        <option value="" selected="selected" disabled="disabled">Your transport</option>
                		        <option value="bike">Bike</option>
                		        <option value="car">Car</option>
                		        <option value="plain">Plain</option>
                		        <option value="boat">Boat</option>
                		        <option value="no">No</option>
                	        </select>
                	        <i class="fa fa-check-circle"></i>
                			<i class="fa fa-exclamation-circle"></i>
                			<small>Error message</small>
                	    </div>
                	    <div class="form-control">
                	        <label class="extra-margin">Gender</label>
                	        <div class="gold-grad radio">
                    	        <div>
                    	            <label class="container" for="01">Male
                        	            <input type="radio" id="01" name="gender" value="male">
                        	            <span class="checkmark"></span>
                    	            </label>
                    	        </div>
                    	        <div>
                     	            <label class="container" for="02">Female
                     	                <input type="radio" id="02" name="gender" value="female">
                     	                <span class="checkmark"></span>
                     	            </label>
                                </div>
                                <div>
                     	            <label class="container" for="03">Other
                     	                <input type="radio" id="03" name="gender" value="other">
                     	                <span class="checkmark"></span>
                     	            </label>
                                </div>
                                <small>Error message</small>
                            </div>
                        </div>
                        <button type="submit">Submit</button>
                    </form>
                </div>
                <button id="btnforclick" style="display:none!important;"></button>
            </div>
{% endblock %}

{% block scripts %}
        <script>
            // For custom Select
            let customDiv, selElmnt, selField, selMenu, selItem,
                // For storing list of all countries
                countries = [],
                // Make sure when the first submission is happened
                submissionCount = 0,
                // All the data provided by a user
                formValues = {};
                // Get the snackbar for displaying error or success messages
            const SNACK_BAR = document.getElementById('snackbar'),
                // Toggle password visibility
                EYES = document.getElementsByClassName('toggle-password'),
                FORM = document.getElementById('form1');
            // If a browser supports storage, create new empty storage
            if (typeof(Storage) !== 'undefined') {
                cart = [];
                setStorageObj('cart', cart);
            } else {
                showErrorBar('Sorry, your browser doesn\'t support data storage');
            }
            for (let i = 0, j = EYES.length; i < j; i++) {
                EYES[i].addEventListener('click', function(e) {
                    const inpt = this.parentNode.querySelector('input');
                    if (this.classList.contains('fa-eye-slash')) {
                        this.classList.remove('fa-eye-slash');
                        this.classList.add('fa-eye');
                    } else {
                        this.classList.add('fa-eye-slash');
                        this.classList.remove('fa-eye');
                    }
                    inpt.type === 'password' ? inpt.type = 'text' : inpt.type = 'password';
                });
            }
            // Custom select
            // Hide original SELECT element
            document.querySelector('select').style.display = 'none';
            // Look for an element with the class "custom-select":
            customDiv = document.querySelector('.custom-select');
            selElmnt = customDiv.querySelector('select');
            // For each element, create a new DIV that will act as the selected item:
            selField = document.createElement('DIV');
            selField.setAttribute('class', 'select-selected');
            selField.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
            customDiv.appendChild(selField);
            // For each element, create a new DIV that will contain the option list:
            selMenu = document.createElement('DIV');
            selMenu.setAttribute('class', 'select-items select-hide');
            for (let i = 1, j = selElmnt.length; i < j; i++) {
                // For each option in the original select element,
                // create a new DIV that will act as an option item:
                selItem = document.createElement('DIV');
                selItem.innerHTML = selElmnt.options[i].innerHTML;
                selItem.addEventListener('click', function(e) {
                    // When an item is clicked, update the original select box, and the selected item:
                    let prevSelected, origSelect, prevSib;
                    origSelect = this.parentNode.parentNode.querySelector('select');
                    prevSib = this.parentNode.previousSibling;
                    for (let i = 0, j = origSelect.length; i < j; i++) {
                        if (origSelect.options[i].innerHTML === this.innerHTML) {
                            origSelect.selectedIndex = i;
                            prevSib.innerHTML = this.innerHTML;
                            prevSelected = this.parentNode.querySelector('.same-as-selected');
                            if (prevSelected) {
                                prevSelected.removeAttribute('class');
                            }
                            this.setAttribute('class', 'same-as-selected');
                            break;
                        }
                    }
                    if (submissionCount > 0) {
                        transportValidation();
                    }
                    prevSib.click();
                });
                selMenu.appendChild(selItem);
            }
            customDiv.appendChild(selMenu);
            selField.addEventListener('click', function(e) {
                // When the select box is clicked, close any other select boxes,
                // and open/close the current select box:
                e.stopPropagation();
                this.nextSibling.classList.toggle('select-hide');
                this.classList.toggle('select-arrow-active');
            });
            // If the user clicks anywhere outside the select box, close select box
            document.addEventListener('click', closeSelect);
            // On submit validate all the inputs
            FORM.addEventListener('submit', e => {
                e.preventDefault();
                if (validateForm()) {
                    askServer('/register');
                } else {
                    showErrorBar('One or more of your inputs are invalid', 5000);
                    document.getElementById('btnforclick').click();
                    submissionCount++;
                }
            });
            // Execute this only once after the first 'onclick' event
            document.getElementById('btnforclick').addEventListener('click', function addListenersOnce(e) {
                e.stopPropagation();
                separateValidation();
                document.getElementById('btnforclick').removeEventListener('click', addListenersOnce);
            });
            function closeSelect(elem) {
                const selField = document.querySelector('.select-selected');
                if (elem !== selField) {
                    selField.classList.remove('select-arrow-active');
                    document.querySelector('.select-items').classList.add('select-hide');
                }
            }
            // When all sepate validation functions return 1, the form can be submitted
            function validateForm() {
                // Sum up and return the result
                const validatedCount = usernameValidation() + emailValidation() + passwordValidation() +
                    confirmValidation() + countryValidation() + ageValidation() +
                    transportValidation() + genderValidation();
                return (validatedCount === 8 ? true : false);
            }
            // If after first submission the certain provided data will be invalid, add event listeners to each
            // input field and validate them immediately
            function separateValidation() {
                // Adding event listeners to form elements
                for (let i = 0, j = FORM.length; i < j; i++) {
                    if ((FORM.elements[i].tagName === 'INPUT') && (FORM.elements[i].type !== 'radio')) {
                        FORM.elements[i].addEventListener('input', window[FORM.elements[i].name + 'Validation']);
                    } else if (FORM.elements[i].type === 'radio') {
                        FORM.elements[i].addEventListener('change', window[FORM.elements[i].name + 'Validation']);
                    }
                }
            }
            // Validate a username
            function usernameValidation() {
                const username = FORM['username'],
                    usernameValue = username.value.trim();
                // Validation of a username
                if (usernameValue === '') {
                    setErrorFor(username, 'This field cannot be blank');
                    return 0;
                } else if (/^(?=.*(\s))/.test(usernameValue)) {
            	    setErrorFor(username, 'Please remove all the whitespaces');
            	    return 0;
                } else if (usernameValue.toLowerCase() === 'admin' || usernameValue.toLowerCase() === 'administrator') {
                    setErrorFor(username, 'You cannot have such username');
                    return 0;
                } else if (usernameValue.length > 127) {
                    setErrorFor(username, 'Your username is too long');
                    return 0;
                } else if (containsImoji(username, usernameValue)) {
                    return 0;
                } else {
                    return 1;
                }
            }
            // Validate an email
            function emailValidation() {
                const email = FORM['email'],
                    emailValue = email.value.trim(),
                    // Regex for correct email
            	    emailRegEx = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                // Validation of an email
                if(emailValue === '') {
            		setErrorFor(email, 'This field cannot be blank');
            		return 0;
            	} else if (!emailRegEx.test(emailValue)) {
            		setErrorFor(email, 'Not a valid email');
            		return 0;
            	} else if (emailValue.length > 255) {
                    setErrorFor(email, 'Your email is too long');
                    return 0;
            	} else if (containsImoji(email, emailValue)) {
                    return 0;
                } else {
                    return 1;
                }
            }
            // Validate a password
            function passwordValidation() {
                const password = FORM['password'],
                    passwordValue = password.value;
                // Password must meet all the conditions represented in a RegExs
                // The validation with RegExs could be done by only one line of RegEx, but to make it
                // more custom it requires more conditions
            	if (passwordValue.trim() === '') {
            	    setErrorFor(password, 'Please enter your password');
            	    return 0;
                } else if (/^(?!.*[a-z])/.test(passwordValue)) {
            	    setErrorFor(password, 'Please add at least one lowercase letter');
            	    return 0;
            	} else if (/^(?!.*[A-Z])/.test(passwordValue)) {
            	    setErrorFor(password, 'Please add at least one uppercase letter');
            	    return 0;
            	} else if (/^(?!.*[0-9])/.test(passwordValue)) {
            	    setErrorFor(password, 'Please add one or more digits');
            	    return 0;
            	} else if (/^(?=.*(\s|\t))/.test(passwordValue)) {
            	    setErrorFor(password, 'Please remove all the whitespaces');
            	    return 0;
            	} else if (/^(?!.{6,})/.test(passwordValue)) {
            	    setErrorFor(password, 'Your password is too short');
            	    return 0;
            	} else if (/^(?=.{41,})/.test(passwordValue)) {
            	    setErrorFor(password, 'Your password is too long');
            	    return 0;
            	} else if (containsImoji(password, passwordValue)) {
                    return 0;
                } else {
                    return 1;
                }
            }
            // Validate a confirm password
            function confirmValidation() {
                const password = FORM['password'],
                    password2 = FORM['confirm'];
                // Validate a confirm password
            	if (password2.value.trim() === '') {
            	    setErrorFor(password2, 'Please confirm your password');
            	    return 0;
            	} else if (password2.value !== password.value) {
            	    setErrorFor(password2, 'Your passwords do not match');
            	    return 0;
            	} else {
            	    setSuccessFor(password2);
            	    return 1;
            	}
            }
            // Validate a country
            function countryValidation() {
                const country = FORM['country'],
                    countryValue = country.value.trim().toLowerCase();
                // Validate specified country
            	if (countryValue === '') {
            	    setErrorFor(country, 'Please provide your country');
            	    return 0;
            	} else if (!countries) {
            	    setErrorFor(country, 'Sorry, cannot validate your input');
                    showErrorBar('Server does not respond. Cannot load a list of all countries', 9000);
            	    return 0;
            	} else if (!countries.includes(countryValue)) {
            	    setErrorFor(country, 'Unfortunately there is no such country');
            	    return 0;
            	} else {
            	    setSuccessFor(country);
            	    formValues['country'] = countryValue;
            	    return 1;
            	}
            }
            // Validate an age
            function ageValidation() {
                const age = FORM['age'],
                    ageValue = age.value.trim();

                if (ageValue === '') {
                    setErrorFor(age, 'Please provide your age');
            	    return 0;
                } else if (!/^[0-9]+$/.test(ageValue)) {
                    setErrorFor(age, 'Value must be an integer');
                    return 0;
                } else if (ageValue < 1 || ageValue > 150) {
                    setErrorFor(age, 'Please enter a valid value');
                    return 0;
                } else {
                    setSuccessFor(age);
                    formValues['age'] = parseInt(ageValue);
            	    return 1;
                }
            }
            // Validate a transport
            function transportValidation() {
                const transport = FORM['transport'];
                // Check if a user specified his transport
            	if (transport.value === '') {
            	    setErrorFor(transport, 'Please select your transport');
            	    return 0;
            	} else {
            	    setSuccessFor(transport);
            	    formValues['transport'] = transport.value;
            	    return 1;
            	}
            }
            // Validate a gender
            function genderValidation() {
                const gender = FORM['gender'],
                    divRadio = FORM.querySelector('div.radio');
                // Check if a user specified his gender
        	    if (gender[0].checked) {
        	        formValues['gender'] = gender[0].value;
        	        setSuccessFor(divRadio);
        	        return 1;
        	    } else if (gender[1].checked) {
        	        formValues['gender'] = gender[1].value;
        	        setSuccessFor(divRadio);
        	        return 1;
        	    } else if (gender[2].checked) {
        	        formValues['gender'] = gender[2].value;
        	        setSuccessFor(divRadio);
        	        return 1;
        	    } else {
        	        setErrorFor(divRadio, 'Please specify your gender');
            	    return 0;
        	    }
            }
            // Determine if there is an imoji in an input
            function containsImoji(input, value) {
                // Regex for imojis
                const imojiRegEx = /(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/;
                if (imojiRegEx.test(value)) {
            	    setErrorFor(input, 'Imojis are not allowed');
            	    return true;
                } else {
                    setSuccessFor(input);
                    formValues[input.name] = value;
                    return false;
                }
            }
            // Trow an error to user if an input is invalid
        	function setErrorFor(input, message) {
            	const formControl = input.parentElement;
            	if (formControl.classList.contains('success')) {
            	    formControl.classList.remove('success');
            	}
            	formControl.classList.add('error');
            	formControl.querySelector('small').innerText = message;
            }
            // Make style for success inout visible via adding a class
            function setSuccessFor(input) {
            	const formControl = input.parentElement;
            	if (formControl.classList.contains('error')) {
            	    formControl.classList.remove('error');
                }
            	formControl.classList.add('success');
            }
            // The final validational step is to check whether a user with such username already exists
            function askServer(url) {
                const xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState === 4 && this.status === 200) {
                        const response = JSON.parse(this.responseText);
                        if (response['validated']) {
                            showSuccessBar();
                            document.forms['form1'].reset();
                            window.location.assign('/');
                        } else {
                            showErrorBar('Such username already exists');
                            setErrorFor(document.forms['form1']['username'], response['username']);
                        }
                    } else if (this.status >= 500) {
                        showErrorBar();
                        setErrorFor(document.forms['form1']['username'], 'Sorry, cannot validate your username');
                    }
                };
                xmlhttp.open('POST', url, true);
                xmlhttp.setRequestHeader('Content-type', 'application/json');
                xmlhttp.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                xmlhttp.send(JSON.stringify(formValues));
            }

            // Autocomplete
            function autocomplete(inp) {
                // The autocomplete function takes two arguments,
                // the text field element and an array of possible autocompleted values:
                let currentFocus, position;
                // execute a function when someone writes in the text field:
                inp.addEventListener('input', function(e) {
                    let list, item, tmpVal, tmpArray,
                        val = this.value.toLowerCase(),
                        arrayLen = countries.length;
                    // Close any already open lists of autocompleted values
                    closeAllLists();
                    if (!val) { return false;}
                    currentFocus = -1;
                    let valLen = val.length, firstInpLet = val[0];
                    // Create a DIV element that will contain the items (values):
                    list = document.createElement('DIV');
                    list.setAttribute('id', this.id + 'autocomplete-list');
                    list.setAttribute('class', 'autocomplete-items');
                    // Append the DIV element as a child of the autocomplete container:
                    this.parentNode.appendChild(list);
                    // Find first word in an array that starts with a first letter of an input field
                    findWords(0, arrayLen - 1, firstInpLet);
                    // Position might be 0 and it is a false
                    if (position !== undefined) {
                        do {
                            // Check if the item starts with the same letters as the text field value:
                            if (countries[position].substr(0, valLen) === val) {
                                // Create a DIV element for each matching element:
                                item = document.createElement('DIV');

                                tmpArray = countries[position].split(' ');
                                tmpVal = '';
                                // Make first letters in words uppercase and others lowercase
                                for (let i = 0, j = tmpArray.length; i < j; i++) {
                                    if (tmpArray[i][0] === '(') {
                                        tmpVal += tmpArray[i].toUpperCase();
                                    } else {
                                        tmpVal += tmpArray[i].substring(0,1).toUpperCase() + tmpArray[i].substring(1);
                                    }
                                    if (i < j - 1) {
                                        tmpVal += ' ';
                                    }
                                }
                                // Make the matching letters bold:
                                item.innerHTML = '<strong>' + tmpVal.substr(0, valLen) + '</strong>';
                                item.innerHTML += tmpVal.substr(valLen);
                                // Insert a input field that will hold the current array item's value:
                                item.innerHTML += '<input type="hidden" value="' + tmpVal + '">';
                                // Execute a function when someone clicks on the item value (DIV element):
                                item.addEventListener('click', function(e) {
                                    // Insert the value for the autocomplete text field:
                                    inp.value = this.querySelector('input').value;
                                    // Validate an input field
                                    if (submissionCount > 0) {
                                        countryValidation();
                                    }
                                    // Close the list of autocompleted values,
                                    // (or any other open lists of autocompleted values:
                                    closeAllLists();
                                });
                                list.appendChild(item);
                            }
                            position++;
                        }
                        while (position < arrayLen && countries[position][0] === firstInpLet);
                    }
                });
                // Execute a function presses a key on the keyboard:
                inp.addEventListener('keydown', function(e) {
                    let list = document.getElementById(this.id + 'autocomplete-list');
                    if (list) {
                        list = list.getElementsByTagName('div');
                    }
                    if (e.keyCode == 40) {
                        // If the arrow DOWN key is pressed, increase the currentFocus variable:
                        currentFocus++;
                        // and and make the current item more visible:
                        addActive(list);
                    } else if (e.keyCode == 38) {
                        // If the arrow UP key is pressed, decrease the currentFocus variable:
                        currentFocus--;
                        // and and make the current item more visible:
                        addActive(list);
                    } else if (e.keyCode == 13) {
                        // If the ENTER key is pressed, prevent the form from being submitted,
                        e.preventDefault();
                        if (currentFocus <= -1) {
                            return;
                        }
                        // And simulate a click on the "active" item:
                        if (list) {
                            list[currentFocus].click();
                        }
                    }
                });
                function addActive(list) {
                    // A function to classify an item as "active":
                    if (!list) {
                        return false;
                    }
                    // Start by removing the "active" class on all items:
                    removeActive(list);
                    if (currentFocus >= list.length) {
                        currentFocus = 0;
                    }
                    if (currentFocus < 0) {
                        currentFocus = (list.length - 1);
                    }
                    // Add class "autocomplete-active":
                    list[currentFocus].classList.add('autocomplete-active');
                }
                function removeActive(list) {
                    // A function to remove the "active" class from all autocomplete items:
                    for (let i = 0, j = list.length; i < j; i++) {
                        list[i].classList.remove('autocomplete-active');
                    }
                }
                function closeAllLists(elmnt) {
                    // Close all autocomplete lists in the document,
                    // except the one passed as an argument:
                    const list = document.getElementsByClassName('autocomplete-items');
                    for (let i = 0, j = list.length; i < j; i++) {
                        if (elmnt !== list[i] && elmnt !== inp) {
                            list[i].parentNode.removeChild(list[i]);
                        }
                    }
                }
                // Binary search for needed words
                function findWords(first, last, letter) {
                    // if left only one element
                    if (last - first === 0) {
                        if (countries[last][0] != letter){
                            position = undefined;
                            return;
                        } else {
                            position = last;
                            return;
                        }
                    }
                    // Determine the middle of an subarray
                    let middle = (last + first) / 2;
                    Number.isInteger(middle) ? middle -= 1 : middle = Math.floor(middle);
                    // If a first letter of middle positioned word in a subarray matchs a given letter
                    if (countries[middle][0] === letter) {
                        // Find the first word in an array that strats with a given letter
                        while ((middle - 1) >= 0 && countries[middle - 1][0] === letter) {
                            middle -= 1;
                        }
                        position = middle;
                        return;
                    // if a given letter before
                    } else if (letter < countries[middle][0]) {
                        // if a subarray consists of two elements, a middle will be equal to first
                        // therefor there is no longer elements on the left
                        if (first === middle) {
                            position = undefined;
                            return;
                        }
                        findWords(first, middle - 1, letter);
                    // or after
                    } else {
                        findWords(middle + 1, last, letter);
                    }
                }
                // Execute a function when someone clicks in the document:
                document.addEventListener('click', function (e) {
                    closeAllLists(e.target);
                });
            }
            // Load data only once after the first 'onfocus' event
            document.getElementById('country').addEventListener('focus', getCountries);
            // Common AJAX function for loading files via GET
            function loadDoc(url, cFunction) {
                const xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.status >= 500) {
                        countries = undefined;
                    } else if (this.readyState === 4 && this.status === 200) {
                        document.getElementById('country').removeEventListener('focus', getCountries);
                        cFunction(this);
                    }
                };
                xmlhttp.open('GET', url, true);
                xmlhttp.send();
            }
            // Custom function for AJAX
            function callAutocomplete(xmlhttp) {
                countries = JSON.parse(xmlhttp.responseText);
                // Initiate the autocomplete function on the "country_input" element
                autocomplete(document.getElementById('country'));
            }
            function showSuccessBar(text='Successfully') {
                SNACK_BAR.innerText = text;
                SNACK_BAR.className = 'show success';
            }
            function showErrorBar(text='Server does not respond', time = 6000) {
                SNACK_BAR.innerText = text;
                SNACK_BAR.className = 'show error';
                // After 5 seconds, remove the show class from DIV
                setTimeout(function(){ SNACK_BAR.className = SNACK_BAR.className.replace('show ', ''); }, time);
            }
            // Get countries from the server via AJAX
            function getCountries() {
                loadDoc('/register?array=giveme', callAutocomplete);
            }
        </script>
{% endblock %}